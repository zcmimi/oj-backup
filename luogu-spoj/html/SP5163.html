<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>VIENTIAN - Tower of Vientiane - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573449917:TXd9lp2+GSB7TH7VSpcBfZdjZn7VUV+5xFM/KjDwu1I=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22The%20Tower%20of%20Hanoi%20is%20a%20mathematical%20game%20or%20puzzle.%20It%20consists%20of%20three%20rods%2C%20and%20a%20number%20of%20disks%20of%20different%20sizes%20which%20can%20slide%20onto%20any%20rod.%20The%20puzzle%20starts%20with%20the%20disks%20neatly%20stacked%20in%20order%20of%20size%20on%20one%20rod%2C%20the%20smallest%20at%20the%20top%2C%20thus%20making%20a%20conical%20shape.%20The%20objective%20of%20the%20puzzle%20is%20to%20move%20the%20entire%20stack%20to%20another%20rod%2C%20obeying%20the%20following%20rules%3A%5Cn%5Cn-%20Only%20one%20disk%20may%20be%20moved%20at%20a%20time.%5Cn-%20Each%20move%20consists%20of%20taking%20the%20upper%20disk%20from%20one%20of%20the%20rods%20and%20sliding%20it%20onto%20another%20rod%2C%20on%20top%20of%20the%20other%20disks%20that%20may%20already%20be%20present%20on%20that%20rod.%5Cn-%20No%20disk%20may%20be%20placed%20on%20top%20of%20a%20smaller%20disk.%5Cn%5CnIt%20is%20known%20that%20the%20puzzle%20can%20be%20solved%20in%20%2A%2A2%20%24%20%5E%7Bn%7D%20%24%20-1%2A%2A%20steps%20for%20n%20disks.%5Cn%5CnNow%20consider%20the%20puzzle%20called%20The%20Tower%20of%20Vientiane.%20The%20rules%20are%20almost%20the%20same%20as%20for%20The%20Tower%20of%20Hanoi.%20But%20additionally%20there%20are%20limitations%20on%20the%20allowed%20moves.%20Let%20the%20initial%20rod%20be%20numbered%201%2C%20the%20target%20rod%20-%203%2C%20and%20the%20auxiliary%20rod%20-%202.%20The%20matrix%20of%20allowed%20moves%20is%20given.%20For%20example%20is%20can%20be%20allowed%20to%20move%20disks%20from%20rod%201%20to%20rod%202%20only%2C%20from%20rod%202%20to%20rod%203%20and%20from%20rod%203%20to%20rod%201.%20You%20are%20to%20find%20out%20the%20minimal%20number%20of%20moves%20in%20which%20the%20puzzle%20can%20be%20solved%20given%20some%20limitations%20on%20the%20allowed%20moves.%22%2C%22inputFormat%22%3A%22The%20first%20line%20of%20the%20input%20contains%20number%20%2A%2At%2A%2A%20%5Cu2013%20the%20amount%20of%20tests.%20Then%20%2A%2At%2A%2A%20test%20descriptions%20follow.%20The%20test%20starts%20with%20a%20%2A%2A3x3%2A%2A%20matrix%2C%20consisting%20of%20%2A%2A1s%2A%2A%20and%20%2A%2A0s%2A%2A.%20The%20%2A%2A1%2A%2A%20in%20%2A%2Ai-th%2A%2A%20row%20and%20%2A%2Aj-th%2A%2A%20column%20of%20the%20matrix%20means%20that%20the%20move%20from%20rod%20%2A%2Ai%2A%2A%20to%20rod%20%2A%2Aj%2A%2A%20is%20allowed%2C%20otherwise%20it%20is%20not%20allowed.%20The%20next%20line%20of%20each%20test%20contains%20the%20number%20%2A%2An%2A%2A%20-%20the%20amount%20of%20disks%20for%20the%20corresponding%20testcase.%22%2C%22outputFormat%22%3A%22For%20each%20test%20print%20the%20minimal%20number%20of%20moves%20in%20which%20the%20puzzle%20can%20be%20solved%20or%20%5C%22Epic%20Fail...%5C%22%20if%20it%27s%20impossible%20to%20solve%20the%20puzzle%20under%20such%20limitations.%22%2C%22samples%22%3A%5B%5B%223%5Cr%5Cn011%5Cr%5Cn101%5Cr%5Cn110%5Cr%5Cn5%5Cr%5Cn010%5Cr%5Cn101%5Cr%5Cn010%5Cr%5Cn5%5Cr%5Cn010%5Cr%5Cn001%5Cr%5Cn010%5Cr%5Cn5%22%2C%2231%5Cr%5Cn242%5Cr%5CnEpic%20Fail...%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B379%5D%2C%22memory%22%3A%5B1536000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22SPOJ%22%2C%22link%22%3A%22%5C%2Fjump%5C%2Fspoj%5C%2F5163%22%2C%22id%22%3A%225163%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22SP5163%22%2C%22title%22%3A%22VIENTIAN%20-%20Tower%20of%20Vientiane%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22SP%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22VIENTIAN%20-%20Tower%20of%20Vientiane%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>VIENTIAN - Tower of Vientiane</h1>
<h2>题目描述</h2>
<div>The Tower of Hanoi is a mathematical game or puzzle. It consists of three rods, and a number of disks of different sizes which can slide onto any rod. The puzzle starts with the disks neatly stacked in order of size on one rod, the smallest at the top, thus making a conical shape. The objective of the puzzle is to move the entire stack to another rod, obeying the following rules:
- Only one disk may be moved at a time.
- Each move consists of taking the upper disk from one of the rods and sliding it onto another rod, on top of the other disks that may already be present on that rod.
- No disk may be placed on top of a smaller disk.
It is known that the puzzle can be solved in **2 $ ^{n} $ -1** steps for n disks.
Now consider the puzzle called The Tower of Vientiane. The rules are almost the same as for The Tower of Hanoi. But additionally there are limitations on the allowed moves. Let the initial rod be numbered 1, the target rod - 3, and the auxiliary rod - 2. The matrix of allowed moves is given. For example is can be allowed to move disks from rod 1 to rod 2 only, from rod 2 to rod 3 and from rod 3 to rod 1. You are to find out the minimal number of moves in which the puzzle can be solved given some limitations on the allowed moves.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line of the input contains number **t** – the amount of tests. Then **t** test descriptions follow. The test starts with a **3x3** matrix, consisting of **1s** and **0s**. The **1** in **i-th** row and **j-th** column of the matrix means that the move from rod **i** to rod **j** is allowed, otherwise it is not allowed. The next line of each test contains the number **n** - the amount of disks for the corresponding testcase.</div>
<h3>输出格式</h3>
<br />
<div>For each test print the minimal number of moves in which the puzzle can be solved or "Epic Fail..." if it's impossible to solve the puzzle under such limitations.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>3
011
101
110
5
010
101
010
5
010
001
010
5</code></pre>
<h3>输出样例 #1</h3>
<pre><code>31
242
Epic Fail...</code></pre>
</article>
</div>
</div>
</body>
</html>
