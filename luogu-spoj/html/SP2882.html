<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>WARE - The Warehouse - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573449765:23RzxuqHLd5UTAKihTmerYEiGe3IOdjOSZ72gvIjyPQ=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Secret%20Agent%20OmeGa-7%20has%20found%20the%20secret%20weapon%20warehouse%20of%20the%20mad%20scientist%20Dr.%20Matroid.%20The%20warehouse%20is%20full%20of%20large%20boxes%20%28possibly%20with%20deadly%20weapons%20inside%20the%20boxes%29.%20While%20inspecting%20the%20warehouse%2C%20OmeGa-7%20accidentally%20triggered%20the%20alarm%20system.%20The%20warehouse%20has%20a%20very%20effective%20protection%20against%20intruders%3A%20if%20the%20alarm%20is%20triggered%2C%20then%20the%20floor%20is%20filled%20with%20deadly%20acid.%20Therefore%2C%20the%20only%20way%20OmeGa-7%20can%20escape%20is%20to%20climb%20onto%20the%20boxes%20and%20somehow%20reach%20the%20exit%20on%20top%20of%20them.%20The%20exit%20is%20a%20hole%20in%20the%20ceiling%2Cif%20OmeGa-7%20can%20climb%20through%20this%20hole%20then%20he%20can%20escape%20using%20the%20helicopter%20parked%20on%20the%20roof.%20There%20is%20a%20ladder%20and%20a%20box%20below%20the%20hole%2C%20thus%20the%20goal%20is%20to%20reach%20this%20box.%5Cn%5CnThe%20floor%20of%20the%20warehouse%20can%20be%20divided%20into%20a%20grid%20containing%20n%20%5C%5C%2A%20n%20cells%2C%20the%20size%20of%20each%20cell%20is%201%20meter%20%5C%5C%2A%201%20meter.%20Each%20cell%20is%20either%20fully%20occupied%20by%20one%20box%20or%20unoccupied.%20Each%20box%20is%20rectangular%3A%20the%20size%20of%20the%20base%20is%201%20meter%20%5C%5C%2A%201%20meter%2C%20and%20the%20height%20is%20either%202%2C%203%2C%20or%204%20meters.%20In%20figure%20%28a%29%2C%20you%20can%20see%20an%20example%20warehouse%2C%20where%20the%20numbers%20show%20the%20height%20of%20the%20boxes%2C%20E%20shows%20the%20exit%2C%20and%20the%20circle%20shows%20that%20Secret%20Agent%20OmeGa-7%20is%20currently%20on%20the%20top%20of%20that%20box.%5Cn%5Cn%21%5B%5D%28https%3A%5C%2F%5C%2Fcdn.luogu.com.cn%5C%2Fupload%5C%2Fvjudge_pic%5C%2FSP2882%5C%2F46c8eface8aff6bd040f1631c70a49cc91428f9f.png%29%5Cn%5CnOmeGa-7%20can%20do%20two%20things%3A%5Cn%5CnIf%20he%20is%20standing%20on%20top%20of%20a%20box%2C%20and%20in%20an%20adjacent%20cell%20there%20is%20another%20box%2C%20then%20he%20can%20move%20to%20the%20top%20of%20this%20other%20box.%20For%20example%2C%20in%20the%20situation%20depicted%20in%20figure%20%28a%29%2C%20he%20can%20move%20either%20to%20north%20or%20east%2C%20but%20not%20to%20west%20or%20south.%20Note%20that%20only%20these%20four%20directions%20are%20allowed%2C%20diagonal%20moves%20are%20not%20possible.%20The%20height%20difference%20between%20the%20two%20boxes%20does%20not%20matter.%5Cn%5CnThe%20second%20thing%20OmeGa-7%20can%20do%20is%20that%20he%20can%20topple%20the%20box%20he%20is%20standing%20on%20in%20one%20of%20the%20four%20directions.%20The%20effect%20of%20toppling%20is%20best%20shown%20by%20an%20example%3A%20in%20the%20situation%20shown%20in%20figure%20%28b%29%2C%20he%20can%20topple%20the%20box%20west%20%28figure%20%28c%29%29%20or%20north%20%28figure%20%28d%29%29.%20If%20a%20box%20of%20height%20h%20is%20toppled%20north%20%28west%2C%20south%2C%20etc.%29%20then%20it%20will%20occupy%20h%20consecutive%20cells%20to%20the%20north%20%28west%2C%20south%2C%20etc.%29%20of%20its%20original%20position.%20The%20original%20position%20will%20be%20unoccupied%20%28but%20can%20be%20later%20occupied%20again%20by%20toppling%20another%20box%29.%20A%20box%20can%20only%20be%20toppled%20if%20the%20cells%20where%20it%20will%20fall%20are%20unoccupied.%20For%20example%2C%20in%20figure%20%28a%29%2C%20the%20box%20where%20OmeGa-7%20is%20standing%20cannot%20be%20toppled%20in%20any%20of%20the%20four%20directions.%5Cn%5CnBy%20toppling%20a%20box%2C%20OmeGa-7%20jumps%20one%20step%20in%20the%20direction%20that%20the%20box%20is%20toppled%20%28see%20figures%20%28c%29%20and%28d%29%29.%20If%20a%20box%20is%20toppled%2C%20then%20it%20cannot%20be%20toppled%20again%20later.%20Recall%20that%20there%20is%20a%20box%20below%20the%20exit%20%28at%20the%20cell%20marked%20with%20E%20in%20the%20figure%29%2C%20thus%20it%20is%20not%20possible%20to%20topple%20a%20box%20over%20this%20cell.%20The%20alarm%20system%20will%20soon%20release%20mutant%20poisonous%20biting%20bats%2C%20so%20OmeGa-7%20has%20to%20leave%20the%20warehouse%20as%20quickly%20as%20possible.%20You%20have%20to%20help%20him%20by%20writing%20a%20program%20that%20will%20determine%20the%20minimum%20number%20of%20steps%20required%20to%20reach%20the%20exit.%20Moving%20to%20an%20adjacent%20box%2C%20or%20toppling%20a%20box%20is%20counted%20as%20one%20step.%22%2C%22inputFormat%22%3A%22The%20input%20contains%20several%20blocks%20of%20test%20cases.%20The%20first%20line%20of%20each%20block%20contains%20three%20integers%3A%20the%20size%201%20%3C%3D%20n%20%3C%3D%208%20of%20the%20warehouse%2C%20and%20two%20integers%20i%20%2C%20j%20that%20describe%20the%20starting%20position%20of%20the%20secret%20agent.%20These%20numbers%20are%20between%201%20and%20n%20%3B%20the%20row%20number%20is%20given%20by%20i%20%2C%20the%20column%20number%20is%20given%20by%20j%20.%20The%20next%20n%20lines%20describe%20the%20warehouse.%20Each%20line%20contains%20a%20string%20of%20n%20characters.%20Each%20character%20corresponds%20to%20a%20cell%20of%20the%20warehouse.%20If%20the%20character%20is%20%27.%27%2C%20then%20the%20cell%20is%20unoccupied.%20The%20characters%20%272%27%2C%20%273%27%20and%20%274%27%20correspond%20to%20boxes%20of%20height%202%2C%203%20and%204%2C%20respectively.%20Finally%2C%20the%20character%20%27E%27%20shows%20the%20location%20of%20the%20exit.%5Cn%5CnThe%20input%20is%20terminated%20by%20a%20block%20with%20n%20%3D%20i%20%3D%20j%20%3D%200.%22%2C%22outputFormat%22%3A%22For%20each%20test%20case%2C%20you%20have%20to%20output%20a%20single%20line%20containing%20an%20integer%3A%20the%20minimum%20number%20of%20steps%20required%20to%20reach%20the%20exit.%20If%20it%20is%20not%20possible%20to%20reach%20the%20exit%2C%20then%20output%20the%20text%20%27Impossible.%27%28without%20quotes%29.%22%2C%22samples%22%3A%5B%5B%225%205%203%5Cr%5Cn.2..E%5Cr%5Cn...2.%5Cr%5Cn4....%5Cr%5Cn....4%5Cr%5Cn..2..%5Cr%5Cn0%200%200%22%2C%2218%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B1000%5D%2C%22memory%22%3A%5B1536000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22SPOJ%22%2C%22link%22%3A%22%5C%2Fjump%5C%2Fspoj%5C%2F2882%22%2C%22id%22%3A%222882%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22SP2882%22%2C%22title%22%3A%22WARE%20-%20The%20Warehouse%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22SP%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22WARE%20-%20The%20Warehouse%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>WARE - The Warehouse</h1>
<h2>题目描述</h2>
<div>Secret Agent OmeGa-7 has found the secret weapon warehouse of the mad scientist Dr. Matroid. The warehouse is full of large boxes (possibly with deadly weapons inside the boxes). While inspecting the warehouse, OmeGa-7 accidentally triggered the alarm system. The warehouse has a very effective protection against intruders: if the alarm is triggered, then the floor is filled with deadly acid. Therefore, the only way OmeGa-7 can escape is to climb onto the boxes and somehow reach the exit on top of them. The exit is a hole in the ceiling,if OmeGa-7 can climb through this hole then he can escape using the helicopter parked on the roof. There is a ladder and a box below the hole, thus the goal is to reach this box.
The floor of the warehouse can be divided into a grid containing n \* n cells, the size of each cell is 1 meter \* 1 meter. Each cell is either fully occupied by one box or unoccupied. Each box is rectangular: the size of the base is 1 meter \* 1 meter, and the height is either 2, 3, or 4 meters. In figure (a), you can see an example warehouse, where the numbers show the height of the boxes, E shows the exit, and the circle shows that Secret Agent OmeGa-7 is currently on the top of that box.
![](https://cdn.luogu.com.cn/upload/vjudge_pic/SP2882/46c8eface8aff6bd040f1631c70a49cc91428f9f.png)
OmeGa-7 can do two things:
If he is standing on top of a box, and in an adjacent cell there is another box, then he can move to the top of this other box. For example, in the situation depicted in figure (a), he can move either to north or east, but not to west or south. Note that only these four directions are allowed, diagonal moves are not possible. The height difference between the two boxes does not matter.
The second thing OmeGa-7 can do is that he can topple the box he is standing on in one of the four directions. The effect of toppling is best shown by an example: in the situation shown in figure (b), he can topple the box west (figure (c)) or north (figure (d)). If a box of height h is toppled north (west, south, etc.) then it will occupy h consecutive cells to the north (west, south, etc.) of its original position. The original position will be unoccupied (but can be later occupied again by toppling another box). A box can only be toppled if the cells where it will fall are unoccupied. For example, in figure (a), the box where OmeGa-7 is standing cannot be toppled in any of the four directions.
By toppling a box, OmeGa-7 jumps one step in the direction that the box is toppled (see figures (c) and(d)). If a box is toppled, then it cannot be toppled again later. Recall that there is a box below the exit (at the cell marked with E in the figure), thus it is not possible to topple a box over this cell. The alarm system will soon release mutant poisonous biting bats, so OmeGa-7 has to leave the warehouse as quickly as possible. You have to help him by writing a program that will determine the minimum number of steps required to reach the exit. Moving to an adjacent box, or toppling a box is counted as one step.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The input contains several blocks of test cases. The first line of each block contains three integers: the size 1 <= n <= 8 of the warehouse, and two integers i , j that describe the starting position of the secret agent. These numbers are between 1 and n ; the row number is given by i , the column number is given by j . The next n lines describe the warehouse. Each line contains a string of n characters. Each character corresponds to a cell of the warehouse. If the character is '.', then the cell is unoccupied. The characters '2', '3' and '4' correspond to boxes of height 2, 3 and 4, respectively. Finally, the character 'E' shows the location of the exit.
The input is terminated by a block with n = i = j = 0.</div>
<h3>输出格式</h3>
<br />
<div>For each test case, you have to output a single line containing an integer: the minimum number of steps required to reach the exit. If it is not possible to reach the exit, then output the text 'Impossible.'(without quotes).</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>5 5 3
.2..E
...2.
4....
....4
..2..
0 0 0</code></pre>
<h3>输出样例 #1</h3>
<pre><code>18</code></pre>
</article>
</div>
</div>
</body>
</html>
