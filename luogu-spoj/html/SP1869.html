<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>MKMOOM - Making Mountains Out Of Molehills - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573449694:9EXUhahoUqE4QW/sNfkfbFA+Vag4CtOkeOiXwW0oNsQ=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22A%20macro%20processor%20is%20a%20symbol%20processing%20program.%20It%20takes%20a%20stream%20of%20characters%20as%20its%20input%2C%20and%20produces%20a%20stream%20of%20characters%20as%20its%20output.%20A%20%5Cu201cmacro%5Cu201d%20is%20similar%20to%20ordinary%20function%20in%20that%20it%20has%20a%20definition%2C%20and%20when%20invoked%2C%20that%20definition%20is%20applied%20to%20the%20argument%28s%29%20to%20yield%20the%20result.%20In%20this%20problem%2C%20you%20will%20develop%20a%20simple%20macro%20processor.%5Cn%5Cn%20A%20%5Cu201cmacro%20call%5Cu201d%20consists%20of%20a%20name%20and%20a%20list%20of%20arguments%2C%20separated%20by%20commas.%20The%20name%20is%20preceded%20by%20%27%5C%5C%5B%27%20%28a%20left%20bracket%29%20and%20the%20last%20argument%20is%20followed%20by%20%27%5C%5C%5D%27%20%28a%20right%20bracket%29.%20For%20example%2C%20%5Cu201c%5C%5C%5Bdoit%2Cto%2Cit%5C%5C%5D%5Cu201d%20calls%20the%20macro%20named%20%5Cu201cdoit%5Cu201d%20with%20two%20arguments%2C%20%5Cu201cto%5Cu201d%20and%20%5Cu201cit%5Cu201d.%20%5Cu201c%5C%5C%5Brandom%5C%5C%5D%5Cu201d%20calls%20the%20macro%20named%20%5Cu201crandom%5Cu201d%20with%20no%20arguments.%5Cn%5Cn%20Before%20a%20macro%20can%20be%20called%2C%20it%20must%20be%20defined%20by%20associating%20its%20name%20with%20a%20symbol%20string.%20This%20definition%20string%20may%20contain%20the%20special%20constructions%20%5Cu201c%241%5Cu201d%20through%20%5Cu201c%249%5Cu201d%20to%20reference%20the%20first%20through%20the%20ninth%20macro%20parameters.%20%5Cu201c%240%5Cu201d%20references%20the%20macro%5Cu2019s%20name%20itself.%20When%20the%20macro%20is%20called%2C%20these%20constructions%20are%20literally%20replaced%20by%20the%20values%20of%20the%20parameters.%20For%20example%2C%20suppose%20the%20definition%20string%20for%20the%20macro%20named%20%5Cu201c321%5Cu201d%20was%20%5Cu201c%243-%242-%241%5Cu201d.%20The%20macro%20call%20%5Cu201c%5C%5C%5B321%2CThis%2Cis%2Cfun%5C%5C%5D%5Cu201d%20would%20yield%20the%20output%20%5Cu201cfun-is-This%5Cu201d.%20A%20macro%20call%20can%20appear%20anywhere.%20For%20example%2C%20the%20macro%20call%20%5Cu201c%5C%5C%5B321%2C%5C%5C%5B321%2CA%2CB%2CC%5C%5C%5D%2CD%2CE%5C%5C%5D%5Cu201d%20would%20yield%20the%20output%20%5Cu201cE-D-C-B-A%5Cu201d.%5Cn%5Cn%20Input%20enclosed%20in%20%27%3C%27%20and%20%27%3E%27%20prevents%20the%20evaluation%20of%20the%20text%20enclosed%2C%20allowing%20special%20characters%20like%20%27%5C%5C%5B%27%2C%20%27%5C%5C%5D%27%2C%20%27%2C%27%20and%20%27%24%27%20to%20be%20used%20in%20other%20than%20their%20usual%20contexts.%20Thus%20the%20macro%20call%20%5Cu201c%5C%5C%5B321%2C%3C%24%3E%2C%3C%5C%5C%5B%3E%2C%3C%2C%3E%5C%5C%5D%5Cu201d%20would%20yield%20%5Cu201c%2C-%5C%5C%5B-%24%5Cu201d.%5Cn%5Cn%20Macros%20are%20defined%20using%20the%20predefined%20macro%20named%20%5Cu201cdef%5Cu201d%2C%20which%20has%20two%20arguments.%20The%20first%20argument%20is%20the%20name%20of%20the%20macro%20being%20defined%2C%20and%20the%20second%20argument%20is%20the%20defining%20symbol%20string%20for%20the%20macro.%20The%20%5Cu201c321%5Cu201d%20macro%20definition%20is%20%5Cu201c%5C%5C%5Bdef%2C321%2C%3C%243-%242-%241%3E%5C%5C%5D%5Cu201d.%20Note%20that%20the%20definition%20is%20enclosed%20in%20%27%3C%27%20and%20%27%3E%27%20to%20prevent%20%5Cu201c%241%5Cu201d%2C%20%5Cu201c%242%5Cu201d%2C%20and%20%5Cu201c%243%5Cu201d%20from%20being%20interpreted%20as%20parameter%20references%20to%20def.%20The%20def%20macro%20produces%20no%20output.%20Naturally%2C%20the%20def%20macro%20isn%5Cu2019t%20defined%20using%20def%2C%20but%20is%20treated%20specially%20by%20the%20implementation.%5Cn%5Cn%20%2A%2AProcessing%2A%2A%5Cn%5Cn%20The%20input%20stream%20is%20processed%20character%20by%20character%20and%20copied%20to%20the%20output%20until%20a%20macro%20call%20is%20encountered%2C%20or%20the%20input%20is%20exhausted%20%28which%20terminates%20processing%29.%20A%20macro%20call%20is%20evaluated%20as%20described%20below%2C%20with%20the%20result%20%28if%20any%29%20copied%20to%20the%20output.%5Cn%5Cn1.%20The%20macro%20name%20and%20the%20parameters%20are%20evaluated%20in%20sequence%20from%20left%20to%20right.%20This%20may%20require%20evaluating%20additional%20macro%20calls%2C%20which%20must%20be%20processed%20recursively.%5Cn2.%20When%20the%20argument%20list%20is%20complete%20%28that%20is%2C%20when%20the%20closing%20%27%5C%5C%5D%27%20is%20encountered%29%20the%20definition%20of%20the%20macro%20being%20called%20is%20scanned%20in%20the%20same%20manner%20as%20the%20original%20input%20stream%20except%20that%20occurrences%20of%20%5Cu201c%240%5Cu201d%2C%20%5Cu201c%241%5Cu201d%2C%20and%20so%20forth%20are%20replaced%20literally%20by%20the%20corresponding%20arguments.%20The%20result%20of%20the%20macro%20call%20is%20the%20symbol%20stream%20produced%20by%20this%20scan.%5Cn3.%20When%20the%20macro%20call%20is%20completed%2C%20the%20macro%20name%20and%20the%20arguments%20are%20discarded%2C%20and%20processing%20resumes%20at%20the%20point%20where%20it%20was%20interrupted%20by%20the%20macro%20call.%5Cn%5Cn%20%2A%2ALimits%20and%20Caveats%2A%2A%5Cn%5Cn%20Macro%20names%20and%20arguments%20will%20contain%20no%20more%20than%2032%20characters%20each.%20The%20defining%20string%20for%20a%20macro%20will%20contain%20no%20more%20than%20100%20characters.%20Macros%20will%20never%20be%20defined%20more%20than%20once%20%28that%20is%2C%20the%20same%20macro%20name%20will%20not%20be%20used%20more%20than%20once%20as%20the%20first%20argument%20to%20%5Cu201cdef%5Cu201d%29.%20Macro%20calls%20will%20always%20provide%20the%20correct%20number%20of%20arguments.%20Character%20case%20is%20significant%20in%20comparisons.%20All%20input%20characters%2C%20including%20end%20of%20line%20characters%2C%20are%20to%20be%20processed%20through%20the%20macro%20processor.%20No%20output%20line%20will%20contain%20more%20than%2080%20characters%2C%20including%20the%20end%20of%20line%20character.%20The%20input%20is%20guaranteed%20to%20be%20correct.%22%2C%22inputFormat%22%3A%22There%20will%20be%20multiple%20cases%20to%20consider.%20The%20input%20for%20each%20case%20begins%20with%20a%20line%20containing%20a%20single%20integer%20between%201%20and%2010%2C%20that%20specifies%20the%20number%20of%20lines%20of%20text%20immediately%20following%20that%20will%20be%20used%20as%20input%20to%20the%20macro%20processor.%20None%20of%20these%20lines%20will%20contain%20more%20than%2080%20characters%2C%20so%20the%20input%20to%20the%20macro%20processor%20will%20contain%20at%20most%20810%20characters.%20The%20last%20case%20will%20be%20followed%20by%20a%20line%20containing%20the%20integer%200.%22%2C%22outputFormat%22%3A%22For%20each%20input%20case%2C%20display%20the%20case%20number%20%281%2C%202%2C%20%5Cu2026%29%2C%20a%20line%20containing%2079%20hyphens%2C%20the%20output%20from%20the%20macro%20processor%2C%20another%20line%20containing%2079%20hyphens%2C%20and%20a%20blank%20line.%5Cn%5Cn%20In%20the%20sample%20input%20shown%20below%2C%20assume%20that%20the%20last%20visible%20character%20on%20each%20line%20is%20immediately%20followed%20by%20the%20end%20of%20line%20character.%20Blank%20lines%20in%20the%20expected%20output%20are%20shown%20here%20as%20%5C%5C%2A%5C%5C%2ABLANK%5C%5C%2A%5C%5C%2A%20for%20clarity%2C%20but%20these%20should%20actually%20be%20totally%20blank%20in%20your%20output.%22%2C%22samples%22%3A%5B%5B%221%5Cr%5CnThis%20is%20just%20copied%20%28including%20end%20of%20line%29.%5Cr%5Cn1%5Cr%5Cn%5Bdef%2C321%2C%5D%5B321%2CThis%2Cis%2Cfun%5D%5Cr%5Cn1%5Cr%5Cn%5Bdef%2C321%2C%5D%5B321%2C%5B321%2CA%2CB%2CC%5D%2CD%2CE%5D%5Cr%5Cn1%5Cr%5Cn%5Bdef%2C321%2C%5D%5B321%2CThis%2Cis%2Cfun%5D%5B321%2C%5B321%2CA%2CB%2CC%5D%2CD%2CE%5D%5Cr%5Cn3%5Cr%5Cn%5Bdef%2C321%2C%5D%5Cr%5Cn%5B321%2CThis%2Cis%2Cfun%5D%5Cr%5Cn%5B321%2C%5B321%2CA%2CB%2CC%5D%2CD%2CE%5D%5Cr%5Cn3%5Cr%5Cn%5Bdef%2CA%2C%5D%5Cr%5Cn%5Bdef%2CB%2C%2AB%2A%5D%5Cr%5Cn%5BA%2C1%2C2%5D%5Cr%5Cn2%5Cr%5Cn%5Bdef%2C%23%2C%5D%5Bdef%2C-%2C%5D%5Bdef%2CDEF%2Cdef%5D%5B%5BDEF%5D%2CX%2CTHIS%20IS%20X%5D%5Cr%5Cn%5BX%5D%5B%23%2CDEF%2C%23%2CX%5D%5Cr%5Cn0%22%2C%22Case%201%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5CnThis%20is%20just%20copied%20%28including%20end%20of%20line%29.%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5CnCase%202%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cnfun-is-This%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5CnCase%203%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5CnE-D-C-B-A%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5CnCase%204%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cnfun-is-ThisE-D-C-B-A%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5CnCase%205%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5Cnfun-is-This%5Cr%5CnE-D-C-B-A%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5CnCase%206%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5Cn1%2AB%2A2%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5CnCase%207%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%5Cr%5CnTHIS%20IS%20X-DEF-%23-X-%5Cr%5Cn-------------------------------------------------------------------------------%5Cr%5Cn%2A%2ABLANK%2A%2A%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B173%5D%2C%22memory%22%3A%5B1536000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22SPOJ%22%2C%22link%22%3A%22%5C%2Fjump%5C%2Fspoj%5C%2F1869%22%2C%22id%22%3A%221869%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22SP1869%22%2C%22title%22%3A%22MKMOOM%20-%20Making%20Mountains%20Out%20Of%20Molehills%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22SP%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22MKMOOM%20-%20Making%20Mountains%20Out%20Of%20Molehills%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>MKMOOM - Making Mountains Out Of Molehills</h1>
<h2>题目描述</h2>
<div>A macro processor is a symbol processing program. It takes a stream of characters as its input, and produces a stream of characters as its output. A “macro” is similar to ordinary function in that it has a definition, and when invoked, that definition is applied to the argument(s) to yield the result. In this problem, you will develop a simple macro processor.
A “macro call” consists of a name and a list of arguments, separated by commas. The name is preceded by '\[' (a left bracket) and the last argument is followed by '\]' (a right bracket). For example, “\[doit,to,it\]” calls the macro named “doit” with two arguments, “to” and “it”. “\[random\]” calls the macro named “random” with no arguments.
Before a macro can be called, it must be defined by associating its name with a symbol string. This definition string may contain the special constructions “$1” through “$9” to reference the first through the ninth macro parameters. “$0” references the macro’s name itself. When the macro is called, these constructions are literally replaced by the values of the parameters. For example, suppose the definition string for the macro named “321” was “$3-$2-$1”. The macro call “\[321,This,is,fun\]” would yield the output “fun-is-This”. A macro call can appear anywhere. For example, the macro call “\[321,\[321,A,B,C\],D,E\]” would yield the output “E-D-C-B-A”.
Input enclosed in '<' and '>' prevents the evaluation of the text enclosed, allowing special characters like '\[', '\]', ',' and '$' to be used in other than their usual contexts. Thus the macro call “\[321,<$>,<\[>,<,>\]” would yield “,-\[-$”.
Macros are defined using the predefined macro named “def”, which has two arguments. The first argument is the name of the macro being defined, and the second argument is the defining symbol string for the macro. The “321” macro definition is “\[def,321,<$3-$2-$1>\]”. Note that the definition is enclosed in '<' and '>' to prevent “$1”, “$2”, and “$3” from being interpreted as parameter references to def. The def macro produces no output. Naturally, the def macro isn’t defined using def, but is treated specially by the implementation.
**Processing**
The input stream is processed character by character and copied to the output until a macro call is encountered, or the input is exhausted (which terminates processing). A macro call is evaluated as described below, with the result (if any) copied to the output.
1. The macro name and the parameters are evaluated in sequence from left to right. This may require evaluating additional macro calls, which must be processed recursively.
2. When the argument list is complete (that is, when the closing '\]' is encountered) the definition of the macro being called is scanned in the same manner as the original input stream except that occurrences of “$0”, “$1”, and so forth are replaced literally by the corresponding arguments. The result of the macro call is the symbol stream produced by this scan.
3. When the macro call is completed, the macro name and the arguments are discarded, and processing resumes at the point where it was interrupted by the macro call.
**Limits and Caveats**
Macro names and arguments will contain no more than 32 characters each. The defining string for a macro will contain no more than 100 characters. Macros will never be defined more than once (that is, the same macro name will not be used more than once as the first argument to “def”). Macro calls will always provide the correct number of arguments. Character case is significant in comparisons. All input characters, including end of line characters, are to be processed through the macro processor. No output line will contain more than 80 characters, including the end of line character. The input is guaranteed to be correct.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>There will be multiple cases to consider. The input for each case begins with a line containing a single integer between 1 and 10, that specifies the number of lines of text immediately following that will be used as input to the macro processor. None of these lines will contain more than 80 characters, so the input to the macro processor will contain at most 810 characters. The last case will be followed by a line containing the integer 0.</div>
<h3>输出格式</h3>
<br />
<div>For each input case, display the case number (1, 2, …), a line containing 79 hyphens, the output from the macro processor, another line containing 79 hyphens, and a blank line.
In the sample input shown below, assume that the last visible character on each line is immediately followed by the end of line character. Blank lines in the expected output are shown here as \*\*BLANK\*\* for clarity, but these should actually be totally blank in your output.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>1
This is just copied (including end of line).
1
[def,321,][321,This,is,fun]
1
[def,321,][321,[321,A,B,C],D,E]
1
[def,321,][321,This,is,fun][321,[321,A,B,C],D,E]
3
[def,321,]
[321,This,is,fun]
[321,[321,A,B,C],D,E]
3
[def,A,]
[def,B,*B*]
[A,1,2]
2
[def,#,][def,-,][def,DEF,def][[DEF],X,THIS IS X]
[X][#,DEF,#,X]
0</code></pre>
<h3>输出样例 #1</h3>
<pre><code>Case 1
-------------------------------------------------------------------------------
This is just copied (including end of line).
-------------------------------------------------------------------------------
**BLANK**
Case 2
-------------------------------------------------------------------------------
fun-is-This
-------------------------------------------------------------------------------
**BLANK**
Case 3
-------------------------------------------------------------------------------
E-D-C-B-A
-------------------------------------------------------------------------------
**BLANK**
Case 4
-------------------------------------------------------------------------------
fun-is-ThisE-D-C-B-A
-------------------------------------------------------------------------------
**BLANK**
Case 5
-------------------------------------------------------------------------------
**BLANK**
fun-is-This
E-D-C-B-A
-------------------------------------------------------------------------------
**BLANK**
Case 6
-------------------------------------------------------------------------------
**BLANK**
**BLANK**
1*B*2
-------------------------------------------------------------------------------
**BLANK**
Case 7
-------------------------------------------------------------------------------
**BLANK**
THIS IS X-DEF-#-X-
-------------------------------------------------------------------------------
**BLANK**</code></pre>
</article>
</div>
</div>
</body>
</html>
