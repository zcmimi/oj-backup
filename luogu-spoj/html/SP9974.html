<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>MENMARS - Men From Mars - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573450188:h8LV6I3A+bPBlFEyFxltHq+/OVKnHiE92Vrv8ARnB2c=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Beings%20%28men%29%20living%20on%20Mars%20discovered%20that%20there%20are%20beautiful%20beings%20%28women%29%20living%20on%20Venus.%20Men%20decided%20to%20change%20their%20life%20and%20want%20to%20travel%20using%20their%20spaceships%20to%20Venus%20to%20start%20a%20new%20life%20style.%20Unfortunately%2C%20women%20love%20connections%20and%20relationships%20and%20they%20won%5Cu2019t%20let%20a%20group%20of%20spaceships%20pass%20to%20their%20planet%20unless%20the%20number%20of%20spaceships%20in%20one%20of%20the%20%5Cu201cfully%20coupled%5Cu201d%20subgroups%20exceeds%20a%20certain%20minimum%20threshold.%20A%20fully%20coupled%5C%2Fconnected%20group%20of%20spaceships%20is%20a%20group%20with%20each%20pair%20of%20spaceships%20can%20communicate%20together.%5Cn%5CnThe%20spaceships%20and%20their%20airport%20on%20mars%20are%20very%20complicated.%20First%2C%20a%20spaceship%20communicates%20with%20another%20spaceship%20only%20if%20a%20command%20from%20the%20airport%20headquarter%20is%20issued.%20Second%2C%20the%20airport%20is%20a%20small%20one%20that%20can%20launch%20at%20a%20time%20a%20group%20of%20maximum%20K%20spaceships%2C%20connected%20in%20a%20random%20way.%20There%20are%202%20types%20of%20commands%20that%20can%20be%20issued%20from%20headquarter%20to%20manage%20the%20spaceships%20connections%3A%201%29%20%2A%2AFlip%2A%2A%20command%20for%20a%20group%20that%20establishes%20a%20new%20communication%20between%20every%20pair%20of%20disconnected%20spaceships%20and%20disconnect%20every%20previously%20connected%20pair%20of%20spaceships%20in%20the%20group%2C%202%29%20%2A%2AMerge%2A%2A%20command%20for%20some%20of%20the%20groups%20to%20let%20them%20be%20_one%20group_%2C%20but%20no%20communications%5C%2Fconnections%20modifications%20happen.%5Cn%5CnUnfortunately%2C%20under%20these%20constraints%20we%20can%5Cu2019t%20launch%20all%20spaceships%20in%20a%20fully%20coupled%20state%20that%20satisfies%20women.%20So%2C%20the%20Men%20developed%20an%20automatic%20software%20that%20will%20issue%20commands%20to%20launch%20the%20spaceships%20in%20groups%2C%20then%20will%20issue%20commands%20%28Flip%2C%20Merge%29%20in%20a%20way%20that%20hopefully%20produces%20at%20least%20one%20of%20the%20fully%20connected%20subgroups%20with%20maximum%20number%20of%20spaceships%20that%20satisfies%20women%20so%20that%20they%20pass%20to%20Venus.%5Cn%5CnGiven%20the%20groups%20of%20spaceships%20and%20the%20issued%20commands%20for%20them%2C%20you%20have%20to%20calculate%20the%20maximum%20number%20of%20spaceships%20that%20are%20fully%20coupled%20in%20_the%20final%20group_.%5Cn%5Cn%2A%2AInput%20Specification%3A%2A%2A%5Cn%5CnThe%20first%20line%20of%20input%20contains%20an%20integer%20T%20that%20represents%20the%20number%20of%20test%20cases%2C%20then%20follow%20T%20test%20cases.%20Each%20test%20case%20start%20with%20a%20line%20with%20N%20%28the%20number%20of%20spaceships%20-%201%5Cn%5CnThen%20Set%20of%20commands%20are%20given%2C%20each%20one%20on%20a%20line.%20Flip%20command%20on%20format%20%5Cu201c%2A%2AF%2A%2A%20group%5C%5C_id%5Cu201d%20to%20flip%20the%20group%20with%20given%20group%20id.%20Merge%20Command%20on%20format%20%5Cu201c%2A%2AM%2A%2A%20T%20group%5C%5C_id%5C%5C_1%2C%20group%5C%5C_id%5C%5C_2%5Cu2026%20group%5C%5C_id%5C%5C_T%5Cu201d%20that%20merges%20T%20groups%20and%20let%20their%20%2A%2Anew%20id%2A%2A%20to%20be%20the%20maximum%20id%20of%20the%20merged%20groups.%5Cn%5Cn%2A%2AOutput%20Specification%3A%2A%2A%5Cn%5CnFor%20each%20test%20case%2C%20output%20a%20single%20line%20of%20output%20in%20the%20form%20%2A%2A%5Cu201cCase%20K%3A%20T%5Cu201d%2A%2A%20where%20K%20is%20the%20number%20of%20the%20test%20case%20and%20T%20is%20the%20maximum%20number%20of%20spaceships%20that%20are%20fully%20coupled%20in%20the%20final%20group.%20Check%20sample%20below%20for%20the%20format.%5Cn%5Cn%2A%2ASample%20input%3A%2A%2A%5Cn%5Cn1%5Cn%5Cn7%204%5Cn%5Cn3%203%200%201%200%202%201%202%5Cn%5Cn2%201%200%201%5Cn%5Cn1%200%5Cn%5Cn1%200%5Cn%5CnF%201%5Cn%5CnM%202%201%202%5Cn%5CnF%200%5Cn%5CnM%202%200%202%5Cn%5CnF%202%5Cn%5CnM%202%203%202%5Cn%5Cn%5C%5C%2A%5Cn%5Cn%2A%2ASample%20Output%3A%2A%2A%5Cn%5CnCase%201%3A%206%5Cn%5Cn%2A%2ASample%20Explanation%2A%2A%5Cn%5CnIn%20this%20example%20we%20have%207%20spaceships%20in%204%20groups.%20First%20group%20%28id%20%3D%200%29%20is%20forming%20a%20triangle%20shape%2C%20second%20is%20segment%20shape%2C%20third%20is%20isolated%20spaceship%20and%20forth%20%28id%20%3D%203%29%20is%20also%20isolated.%20The%20first%20command%20flips%20the%20second%20group%20to%202%20isolated%20spaceships.%20The%20second%20command%20merge%202%20groups%2C%20id%20%3D2%20to%20have%203%20isolated%20spaceships%20with%20new.%20The%20third%20command%20flips%20first%20group%20to%203%20isolated%20spaceships.%20The%20fourth%20one%20merges%20them%20under%20one%20group%20of%206%20isolated%20group%20with%20id%20%3D%202.%20The%20fifth%20command%20flips%20this%20group%20to%20a%20fully%20coupled%20group%20of%206%20spaceships.%20Finally%20a%20merge%20for%20that%20group%20with%20the%20fourth%20group%20and%20we%20have%20a%20new%20group%20with%20id%20%3D%203%20of%206%20spaceships%20fully%20connected%20and%201%20isolated%20node.%22%2C%22inputFormat%22%3A%22%22%2C%22outputFormat%22%3A%22%22%2C%22samples%22%3A%5B%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B808%5D%2C%22memory%22%3A%5B1536000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22SPOJ%22%2C%22link%22%3A%22%5C%2Fjump%5C%2Fspoj%5C%2F9974%22%2C%22id%22%3A%229974%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22SP9974%22%2C%22title%22%3A%22MENMARS%20-%20Men%20From%20Mars%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22SP%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22MENMARS%20-%20Men%20From%20Mars%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573363392;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>MENMARS - Men From Mars</h1>
<h2>题目描述</h2>
<div>Beings (men) living on Mars discovered that there are beautiful beings (women) living on Venus. Men decided to change their life and want to travel using their spaceships to Venus to start a new life style. Unfortunately, women love connections and relationships and they won’t let a group of spaceships pass to their planet unless the number of spaceships in one of the “fully coupled” subgroups exceeds a certain minimum threshold. A fully coupled/connected group of spaceships is a group with each pair of spaceships can communicate together.
The spaceships and their airport on mars are very complicated. First, a spaceship communicates with another spaceship only if a command from the airport headquarter is issued. Second, the airport is a small one that can launch at a time a group of maximum K spaceships, connected in a random way. There are 2 types of commands that can be issued from headquarter to manage the spaceships connections: 1) **Flip** command for a group that establishes a new communication between every pair of disconnected spaceships and disconnect every previously connected pair of spaceships in the group, 2) **Merge** command for some of the groups to let them be _one group_, but no communications/connections modifications happen.
Unfortunately, under these constraints we can’t launch all spaceships in a fully coupled state that satisfies women. So, the Men developed an automatic software that will issue commands to launch the spaceships in groups, then will issue commands (Flip, Merge) in a way that hopefully produces at least one of the fully connected subgroups with maximum number of spaceships that satisfies women so that they pass to Venus.
Given the groups of spaceships and the issued commands for them, you have to calculate the maximum number of spaceships that are fully coupled in _the final group_.
**Input Specification:**
The first line of input contains an integer T that represents the number of test cases, then follow T test cases. Each test case start with a line with N (the number of spaceships - 1
Then Set of commands are given, each one on a line. Flip command on format “**F** group\_id” to flip the group with given group id. Merge Command on format “**M** T group\_id\_1, group\_id\_2… group\_id\_T” that merges T groups and let their **new id** to be the maximum id of the merged groups.
**Output Specification:**
For each test case, output a single line of output in the form **“Case K: T”** where K is the number of the test case and T is the maximum number of spaceships that are fully coupled in the final group. Check sample below for the format.
**Sample input:**
1
7 4
3 3 0 1 0 2 1 2
2 1 0 1
1 0
1 0
F 1
M 2 1 2
F 0
M 2 0 2
F 2
M 2 3 2
\*
**Sample Output:**
Case 1: 6
**Sample Explanation**
In this example we have 7 spaceships in 4 groups. First group (id = 0) is forming a triangle shape, second is segment shape, third is isolated spaceship and forth (id = 3) is also isolated. The first command flips the second group to 2 isolated spaceships. The second command merge 2 groups, id =2 to have 3 isolated spaceships with new. The third command flips first group to 3 isolated spaceships. The fourth one merges them under one group of 6 isolated group with id = 2. The fifth command flips this group to a fully coupled group of 6 spaceships. Finally a merge for that group with the fourth group and we have a new group with id = 3 of 6 spaceships fully connected and 1 isolated node.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div></div>
<h3>输出格式</h3>
<br />
<div></div>
<h2>输入输出样例</h2>
<i>暂无测试点</i>
</article>
</div>
</div>
</body>
</html>
