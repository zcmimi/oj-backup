<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>COT4 - Count on a trie - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573450271:yrK1qHUHxaOfJ6tJ9CalpAyM0zvu1c8K8uF2npwRyVw=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Maintain%20two%20sets%20of%20strings%20%2A%2AS%2A%2A%20and%20%2A%2AT%2A%2A.%20Initially%2C%20each%20set%20contains%20an%20empty%20string%20with%20id%201.%5Cn%5Cn%20Your%20program%20are%20to%20perform%20the%20following%20four%20operations%3A%5Cn%5Cn1.%20Add%20a%20char%20%2A%2Ac%2A%2A%20to%20the%20end%20of%20an%20existed%20string%20%2A%2ASi%2A%2A%20in%20%2A%2AS%2A%2A%2C%20then%20insert%20the%20new%20string%20into%20%2A%2AS%2A%2A.%20Since%20there%20has%20been%20%2A%2An%2A%2A%20strings%20in%20%2A%2AS%2A%2A%20already%2C%20the%20new%20string%20will%20hold%20the%20id%20%2A%2An%2B1%2A%2A.%5Cn2.%20Add%20a%20char%20%2A%2Ac%2A%2A%20to%20the%20beginning%20or%20to%20the%20end%20of%20an%20existed%20string%20%2A%2ATi%2A%2A%20in%20%2A%2AT%2A%2A%2C%20then%20insert%20the%20new%20string%20into%20%2A%2AT%2A%2A.%5Cn3.%20Choose%20two%20existed%20strings%20%2A%2ATi%2A%2A%20and%20%2A%2ATj%2A%2A%20from%20%2A%2AT%2A%2A%2C%20next%20combine%20them%20into%20a%20new%20one%20%2A%2ATiTj%2A%2A%2C%20then%20insert%20the%20new%20string%20into%20%2A%2AT%2A%2A.%5Cn4.%20Print%20the%20time%20that%20an%20existed%20string%20%2A%2ATi%2A%2A%20in%20%2A%2AT%2A%2A%20appears%20in%20an%20string%20%2A%2ASi%2A%2A%20in%20%2A%2AS%2A%2A.%20Your%20program%20should%20print%200%20if%20%2A%2ATi%2A%2A%20is%20an%20empty%20string.%22%2C%22inputFormat%22%3A%22In%20the%20first%20line%2C%20there%20is%20an%20integer%20%2A%2AQ%2A%2A%2C%20which%20means%20the%20number%20of%20operations%20to%20perform.%5Cn%5CnIn%20the%20next%20%2A%2AQ%2A%2A%20lines%2Cthe%20%2A%2Ai%2A%2A-th%20line%20describes%20the%20%2A%2Ai%2A%2A-th%20operation%20containing%20some%20integers.%20Such%20a%20line%20may%20look%20like%20this%3A%5Cn%5Cn-%201%20Si%20c%5Cn-%202%200%20Ti%20c%20%3D%3E%20add%20%2A%2Ac%2A%2A%20to%20the%20beginning%20of%20%2A%2ATi%2A%2A%5Cn-%202%201%20Ti%20c%20%3D%3E%20add%20%2A%2Ac%2A%2A%20to%20the%20end%20of%20%2A%2ATi%2A%2A%5Cn-%203%20Ti%20Tj%5Cn-%204%20Ti%20Si%5Cn%5Cn%2A%2AQ%2A%2A%20%3C%3D%20300000%2C%20%27a%27%20%3C%3D%20%2A%2Ac%2A%2A%20%3C%3D%20%27z%27%5Cn%5CnThe%20number%20of%20the%20first%20operation%20will%20not%20exceed%20100000.%5Cn%5CnThe%20number%20of%20the%20third%20operation%20will%20not%20exceed%2030000.%5Cn%5CnThe%20number%20of%20fourth%20operation%20will%20not%20exceed%20100000.%22%2C%22outputFormat%22%3A%22For%20each%20%5C%224%20Ti%20Si%5C%22%20operation%2C%20print%20its%20result.%22%2C%22samples%22%3A%5B%5B%2218%5Cr%5Cn1%201%20a%5Cr%5Cn1%202%20a%5Cr%5Cn1%203%20b%5Cr%5Cn1%202%20b%5Cr%5Cn1%205%20a%5Cr%5Cn1%205%20b%5Cr%5Cn2%201%201%20a%5Cr%5Cn3%202%202%5Cr%5Cn2%200%203%20b%5Cr%5Cn2%201%202%20b%5Cr%5Cn3%202%205%5Cr%5Cn3%205%202%5Cr%5Cn4%207%206%5Cr%5Cn4%205%206%5Cr%5Cn4%203%204%5Cr%5Cn4%202%204%5Cr%5Cn4%202%207%5Cr%5Cn4%202%206%22%2C%221%5Cr%5Cn1%5Cr%5Cn1%5Cr%5Cn2%5Cr%5Cn1%5Cr%5Cn2%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B566%5D%2C%22memory%22%3A%5B1536000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22SPOJ%22%2C%22link%22%3A%22%5C%2Fjump%5C%2Fspoj%5C%2F11482%22%2C%22id%22%3A%2211482%22%7D%2C%22translation%22%3A%22%5Cu4efb%5Cu52a1%5Cuff1a%5Cu7ef4%5Cu62a4%5Cu4e24%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32%5Cu5e8f%5Cu5217S%5Cu548cT%5Cuff0c%5Cu8fd9%5Cu4e24%5Cu4e2a%5Cu96c6%5Cu5408%5Cu5728%5Cu5f00%5Cu59cb%5Cu65f6%5Cu90fd%5Cu53ea%5Cu6709%5Cu4e00%5Cu4e2a%5Cu7f16%5Cu53f7%5Cu4e3a1%5Cu7684%5Cu7a7a%5Cu5b57%5Cu7b26%5Cu4e32%5Cu3002%5Cr%5Cn%5Cr%5Cn%5Cu4f60%5Cu7684%5Cu7a0b%5Cu5e8f%5Cu9700%5Cu8981%5Cu652f%5Cu6301%5Cu4ee5%5Cu4e0b%5Cu64cd%5Cu4f5c%5Cuff1a%5Cr%5Cn1.%20%5Cu5728S%5Cu4e2d%5Cu7684%5Cu4e00%5Cu4e2a%5Cu4fdd%5Cu8bc1%5Cu5b58%5Cu5728%5Cu7684%5Cu5b57%5Cu7b26%5Cu4e32%24S_i%24%5Cu7684%5Cu672b%5Cu5c3e%5Cu6dfb%5Cu52a0%5Cu4e00%5Cu4e2a%5Cu5b57%5Cu7b26%24c%24%2C%5Cu7136%5Cu540e%5Cu5c06%5Cu65b0%5Cu7684%5Cu5b57%5Cu7b26%5Cu4e32%5Cu63d2%5Cu5165S%5Cu3002%5Cu5982%5Cu679c%5Cu96c6%5Cu5408%5Cu4e2d%5Cu5df2%5Cu7ecf%5Cu6709n%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32%5Cuff0c%5Cu90a3%5Cu4e48%5Cu8fd9%5Cu4e2a%5Cu65b0%5Cu7684%5Cu5b57%5Cu7b26%5Cu4e32%5Cu7f16%5Cu53f7%5Cu4e3a%24n%2B1%24%5Cr%5Cn2.%20%5Cu5728T%5Cu4e2d%5Cu4e00%5Cu4e2a%5Cu4fdd%5Cu8bc1%5Cu5b58%5Cu5728%5Cu7684%5Cu5b57%5Cu7b26%5Cu4e32%24T_i%24%5Cu7684%5Cu5934%5Cu90e8%5Cu6216%5Cu5c3e%5Cu90e8%5Cu6dfb%5Cu52a0%5Cu4e00%5Cu4e2a%5Cu5b57%5Cu7b26%24c%24%2C%5Cu518d%5Cu6309%5Cu7167%5Cu4e0a%5Cu8ff0%5Cu89c4%5Cu5219%5Cu63d2%5Cu5165T%5Cr%5Cn3.%20%5Cu4eceT%5Cu4e2d%5Cu53d6%5Cu51fa%5Cu4e24%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32%24T_i%24%2C%24T_j%24%5Cuff0c%5Cu5c06%5Cu8fd9%5Cu4e24%5Cu4e2a%5Cu5b57%5Cu7b26%5Cu4e32%5Cu62fc%5Cu63a5%5Cu8d77%5Cu6765%5Cuff08%24T_i%24%5Cu5728%5Cu524d%5Cuff09%5Cuff0c%5Cu6309%5Cu4e0a%5Cu8ff0%5Cu89c4%5Cu5219%5Cu63d2%5Cu5165T%5Cr%5Cn4.%20%5Cu56de%5Cu7b54T%5Cu4e2d%5Cu6307%5Cu5b9a%5Cu5b57%5Cu7b26%5Cu4e32%24T_i%24%5Cu5728S%5Cu4e2d%5Cu6307%5Cu5b9a%5Cu5b57%5Cu7b26%5Cu4e32%24S_i%24%5Cu7684%5Cu51fa%5Cu73b0%5Cu6b21%5Cu6570%5Cu3002%5Cu5982%5Cu679c%24T_i%24%5Cu662f%5Cu4e2a%5Cu7a7a%5Cu4e32%5Cuff0c%5Cu5e94%5Cu5f53%5Cu8f93%5Cu51fa0%5Cr%5Cn%5Cr%5Cn%5Cu8f93%5Cu5165%5Cu683c%5Cu5f0f%5Cuff1a%5Cr%5Cn%5Cr%5Cn%5Cu7b2c%5Cu4e00%5Cu884c%5Cu4e00%5Cu4e2a%5Cu6574%5Cu6570Q%5Cu8868%5Cu793a%5Cu64cd%5Cu4f5c%5Cu6b21%5Cu6570%5Cr%5Cn%5Cr%5Cn%5Cu63a5%5Cu4e0b%5Cu6765Q%5Cu884c%5Cuff0c%5Cu6bcf%5Cu884c%5Cu6709%5Cu4e00%5Cu4e2a%5Cu64cd%5Cu4f5c%5Cuff0c%5Cu64cd%5Cu4f5c%5Cu7684%5Cu683c%5Cu5f0f%5Cu5982%5Cu4e0b%5Cuff1a%5Cr%5Cn-%20%241%24%20%24S_i%24%20%24c%24%5Cr%5Cn-%20%242%24%20%240%24%20%24T_i%24%20%24c%24%20%20%20%20%5Cu8868%5Cu793a%5Cu5728%5Cu5934%5Cu90e8%5Cu63d2%5Cu5165%5Cu5b57%5Cu7b26%5Cr%5Cn-%20%242%24%20%241%24%20%24T_i%24%20%24c%24%20%20%20%20%5Cu8868%5Cu793a%5Cu5728%5Cu5c3e%5Cu90e8%5Cu63d2%5Cu5165%5Cu5b57%5Cu7b26%5Cr%5Cn-%20%243%24%20%24T_i%24%20%24T_j%24%5Cr%5Cn-%20%244%24%20%24T_i%24%20%24S_i%24%5Cr%5Cn%5Cr%5Cn%5Cu7279%5Cu522b%5Cu89c4%5Cu5b9a%5Cuff1a%5Cu64cd%5Cu4f5c1%5Cu4e0d%5Cu8d85%5Cu8fc7100000%5Cu6b21%5Cuff0c%5Cu64cd%5Cu4f5c3%5Cu4e0d%5Cu8d85%5Cu8fc730000%5Cu6b21%5Cuff0c%5Cu64cd%5Cu4f5c4%5Cu4e0d%5Cu8d85%5Cu8fc7100000%5Cu6b21%5Cu3002%5Cu603b%5Cu7684%5Cu64cd%5Cu4f5c%5Cu6b21%5Cu6570Q%5Cu4e0d%5Cu8d85%5Cu8fc7300000%5Cuff0c%5Cu5b57%5Cu7b26%5Cu96c6%5Cu662f%7B%27a%27..%27z%27%7D%5Cr%5Cn%5Cr%5Cn%5Cu8f93%5Cu51fa%5Cu683c%5Cu5f0f%5Cuff1a%5Cr%5Cn%5Cr%5Cn%5Cu5bf9%5Cu4e8e%5Cu6bcf%5Cu4e2a%5Cu64cd%5Cu4f5c4%5Cuff0c%5Cu4f60%5Cu9700%5Cu8981%5Cu8f93%5Cu51fa%5Cu4e00%5Cu4e2a%5Cu6574%5Cu6570%5Cu8868%5Cu793a%5Cu7b54%5Cu6848%5Cuff0c%5Cu8f93%5Cu51fa%5Cu540e%5Cu6362%5Cu884c%22%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Afalse%2C%22totalSubmit%22%3A1%2C%22totalAccepted%22%3A1%2C%22pid%22%3A%22SP11482%22%2C%22title%22%3A%22COT4%20-%20Count%20on%20a%20trie%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22SP%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22COT4%20-%20Count%20on%20a%20trie%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573363392;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>COT4 - Count on a trie</h1>
<h2>题意翻译</h2>
<div>任务：维护两个字符串序列S和T，这两个集合在开始时都只有一个编号为1的空字符串。
你的程序需要支持以下操作：
1. 在S中的一个保证存在的字符串$S_i$的末尾添加一个字符$c$,然后将新的字符串插入S。如果集合中已经有n个字符串，那么这个新的字符串编号为$n+1$
2. 在T中一个保证存在的字符串$T_i$的头部或尾部添加一个字符$c$,再按照上述规则插入T
3. 从T中取出两个字符串$T_i$,$T_j$，将这两个字符串拼接起来（$T_i$在前），按上述规则插入T
4. 回答T中指定字符串$T_i$在S中指定字符串$S_i$的出现次数。如果$T_i$是个空串，应当输出0
输入格式：
第一行一个整数Q表示操作次数
接下来Q行，每行有一个操作，操作的格式如下：
- $1$ $S_i$ $c$
- $2$ $0$ $T_i$ $c$ 表示在头部插入字符
- $2$ $1$ $T_i$ $c$ 表示在尾部插入字符
- $3$ $T_i$ $T_j$
- $4$ $T_i$ $S_i$
特别规定：操作1不超过100000次，操作3不超过30000次，操作4不超过100000次。总的操作次数Q不超过300000，字符集是{'a'..'z'}
输出格式：
对于每个操作4，你需要输出一个整数表示答案，输出后换行</div>
<h2>题目描述</h2>
<div>Maintain two sets of strings **S** and **T**. Initially, each set contains an empty string with id 1.
Your program are to perform the following four operations:
1. Add a char **c** to the end of an existed string **Si** in **S**, then insert the new string into **S**. Since there has been **n** strings in **S** already, the new string will hold the id **n+1**.
2. Add a char **c** to the beginning or to the end of an existed string **Ti** in **T**, then insert the new string into **T**.
3. Choose two existed strings **Ti** and **Tj** from **T**, next combine them into a new one **TiTj**, then insert the new string into **T**.
4. Print the time that an existed string **Ti** in **T** appears in an string **Si** in **S**. Your program should print 0 if **Ti** is an empty string.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>In the first line, there is an integer **Q**, which means the number of operations to perform.
In the next **Q** lines,the **i**-th line describes the **i**-th operation containing some integers. Such a line may look like this:
- 1 Si c
- 2 0 Ti c => add **c** to the beginning of **Ti**
- 2 1 Ti c => add **c** to the end of **Ti**
- 3 Ti Tj
- 4 Ti Si
**Q** <= 300000, 'a' <= **c** <= 'z'
The number of the first operation will not exceed 100000.
The number of the third operation will not exceed 30000.
The number of fourth operation will not exceed 100000.</div>
<h3>输出格式</h3>
<br />
<div>For each "4 Ti Si" operation, print its result.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>18
1 1 a
1 2 a
1 3 b
1 2 b
1 5 a
1 5 b
2 1 1 a
3 2 2
2 0 3 b
2 1 2 b
3 2 5
3 5 2
4 7 6
4 5 6
4 3 4
4 2 4
4 2 7
4 2 6</code></pre>
<h3>输出样例 #1</h3>
<pre><code>1
1
1
2
1
2</code></pre>
</article>
</div>
</div>
</body>
</html>
