<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>TOURNEY - Tourney - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573450408:HoJUjKWyYSwhutGUyzESSJbqoxHrmUGsewXgXXi2tEU=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22Don%20Cherry%20has%20been%20hired%20to%20run%2024-hour%20coverage%20of%20a%20series%20of%20single-elimination%2C%20bracket-style%2C%20furniture%20disassembly%20tourneys%20%28tournaments%29.%20Each%20competitor%20has%20a%20furniture%20disassembly%20skill%20level%2C%20an%20integer%20between%20%24%201%20%24%20and%20%24%2010%5E9%20%24%20.%20In%20every%20head-to-head%20match%2C%20the%20competitor%20with%20the%20larger%20skill%20level%20wins%20and%20moves%20on%2C%20while%20the%20other%20is%20eliminated%20from%20the%20tourney.%20It%20is%20guaranteed%20that%2C%20at%20any%20time%2C%20the%20skill%20levels%20of%20all%20competitors%20are%20distinct%2C%20so%20there%20are%20no%20ties.%5Cn%5CnThere%20are%20%24%202%5EN%20%24%20%28%20%24%201%20%5C%5Cleq%20N%20%5C%5Cleq%2020%20%24%20%29%20competitor%20positions%20in%20the%20tourney%20tree%2C%20numbered%20%24%201%2C%202%2C%20%5C%5Cldots%2C%202%5EN%20%24%20from%20left%20to%20right.%20In%20the%20first%20round%2C%20competitors%201%20and%202%20face%20off%20in%20a%20furniture%20disassembly%20race%2C%20as%20do%20competitors%203%20and%204%2C%20etc.%20In%20each%20subsequent%20round%2C%20the%20winners%20of%20the%20first%20two%20matches%20from%20the%20previous%20round%20compete%2C%20as%20do%20the%20winners%20of%20the%20following%20two%2C%20etc.%20After%20%24%20N%20%24%20rounds%2C%20a%20single%20winner%20remains.%20For%20example%2C%20when%20%24%20N%3D2%20%24%20%2C%20the%20tourney%20tree%20looks%20like%20this%3A%5Cn%5Cn%21%5B%5D%28..%5C%2F..%5C%2F..%5C%2Fcontent%5C%2Fsourspinach%3Atourney1.bmp%29%5Cn%5Cnwhere%20A%20represents%20the%20winner%20of%20the%20match%20between%20competitors%201%20and%202%2C%20B%20represents%20the%20winner%20of%20the%20match%20between%20competitors%203%20and%204%2C%20and%20C%20represents%20the%20winner%20of%20the%20match%20between%20A%20and%20B.%20The%20winner%20of%20this%20tourney%20is%20C.%5Cn%5CnBecause%20of%20sponsorship%20contracts%2C%20some%20competitors%20will%20be%20replaced%20over%20time.%20After%20any%20new%20person%20comes%20in%2C%20a%20new%20tourney%20is%20held.%5Cn%5CnIn%20order%20to%20help%20Don%20Cherry%2C%20you%20must%20write%20a%20program%20to%20compute%20certain%20tourney%20statistics%20at%20various%20points%20in%20time%2C%20given%20a%20sequence%20of%20%24%20M%20%24%20%28%20%24%201%20%5C%5Cleq%20M%20%5C%5Cleq%2010%5E6%20%24%20%29%20commands%20-%20see%20the%20input%20format%20below.%22%2C%22inputFormat%22%3A%22The%20first%20line%20of%20input%20contains%20two%20integers%2C%20%24%20N%20%24%20and%20%24%20M%20%24%20.%5Cn%5CnThe%20next%20%24%202%5EN%20%24%20lines%2C%20for%20%24%20i%20%24%20from%20%24%201%20%24%20to%20%24%202%5EN%20%24%20%2C%20each%20contain%20one%20integer%20%24%20S_i%20%24%20%2C%20indicating%20the%20skill%20level%20of%20the%20initial%20competitor%20at%20position%20%24%20i%20%24%20in%20the%20tourney%20tree.%5Cn%5CnEach%20of%20the%20following%20%24%20M%20%24%20lines%20will%20be%20a%20command%20in%20one%20of%20three%20formats%3A%5Cn%5Cn-%20%5C%22%2A%2AR%2A%2A%20%24%20i%20%24%20%24%20s%20%24%20%5C%22%20means%20that%20the%20competitor%20at%20position%20%24%20i%20%24%20is%20removed%2C%20and%20replaced%20with%20a%20new%20one%20with%20skill%20level%20%24%20s%20%24%20.%20A%20new%20tourney%20should%20then%20be%20held.%5Cn-%20%5C%22%2A%2AW%2A%2A%5C%22%20means%20that%20your%20program%20should%20determine%20who%20won%20the%20current%20tourney.%20Print%20out%20the%20position%20%24%20i%20%24%20%28between%20%24%201%20%24%20and%20%24%202%5EN%20%24%20%29%20of%20this%20competitor.%5Cn-%20%5C%22%2A%2AS%2A%2A%20%24%20i%20%24%20%5C%22%20means%20that%20your%20program%20should%20print%20out%20the%20number%20of%20rounds%20that%20the%20competitor%20at%20position%20%24%20i%20%24%20won%20in%20the%20current%20tourney.%22%2C%22outputFormat%22%3A%22For%20each%20%5C%22%2A%2AW%2A%2A%5C%22%20or%20%5C%22%2A%2AS%2A%2A%20%24%20i%20%24%20%5C%22%20command%20in%20the%20input%2C%20print%20out%20the%20corresponding%20integer%20on%20a%20line%20by%20itself.%22%2C%22samples%22%3A%5B%5B%222%208%5C%5Cn30%5C%5Cn20%5C%5Cn10%5C%5Cn40%5C%5CnS%201%5C%5CnW%5C%5CnR%204%209%5C%5CnS%204%5C%5CnW%5C%5CnR%202%2035%5C%5CnS%202%5C%5CnW%22%2C%22%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B8000%5D%2C%22memory%22%3A%5B1536000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22SPOJ%22%2C%22link%22%3A%22%5C%2Fjump%5C%2Fspoj%5C%2F15074%22%2C%22id%22%3A%2215074%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22SP15074%22%2C%22title%22%3A%22TOURNEY%20-%20Tourney%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22SP%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22TOURNEY%20-%20Tourney%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1573363392;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>TOURNEY - Tourney</h1>
<h2>题目描述</h2>
<div>Don Cherry has been hired to run 24-hour coverage of a series of single-elimination, bracket-style, furniture disassembly tourneys (tournaments). Each competitor has a furniture disassembly skill level, an integer between $ 1 $ and $ 10^9 $ . In every head-to-head match, the competitor with the larger skill level wins and moves on, while the other is eliminated from the tourney. It is guaranteed that, at any time, the skill levels of all competitors are distinct, so there are no ties.
There are $ 2^N $ ( $ 1 \leq N \leq 20 $ ) competitor positions in the tourney tree, numbered $ 1, 2, \ldots, 2^N $ from left to right. In the first round, competitors 1 and 2 face off in a furniture disassembly race, as do competitors 3 and 4, etc. In each subsequent round, the winners of the first two matches from the previous round compete, as do the winners of the following two, etc. After $ N $ rounds, a single winner remains. For example, when $ N=2 $ , the tourney tree looks like this:
![](../../../content/sourspinach:tourney1.bmp)
where A represents the winner of the match between competitors 1 and 2, B represents the winner of the match between competitors 3 and 4, and C represents the winner of the match between A and B. The winner of this tourney is C.
Because of sponsorship contracts, some competitors will be replaced over time. After any new person comes in, a new tourney is held.
In order to help Don Cherry, you must write a program to compute certain tourney statistics at various points in time, given a sequence of $ M $ ( $ 1 \leq M \leq 10^6 $ ) commands - see the input format below.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The first line of input contains two integers, $ N $ and $ M $ .
The next $ 2^N $ lines, for $ i $ from $ 1 $ to $ 2^N $ , each contain one integer $ S_i $ , indicating the skill level of the initial competitor at position $ i $ in the tourney tree.
Each of the following $ M $ lines will be a command in one of three formats:
- "**R** $ i $ $ s $ " means that the competitor at position $ i $ is removed, and replaced with a new one with skill level $ s $ . A new tourney should then be held.
- "**W**" means that your program should determine who won the current tourney. Print out the position $ i $ (between $ 1 $ and $ 2^N $ ) of this competitor.
- "**S** $ i $ " means that your program should print out the number of rounds that the competitor at position $ i $ won in the current tourney.</div>
<h3>输出格式</h3>
<br />
<div>For each "**W**" or "**S** $ i $ " command in the input, print out the corresponding integer on a line by itself.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>2 8\n30\n20\n10\n40\nS 1\nW\nR 4 9\nS 4\nW\nR 2 35\nS 2\nW</code></pre>
<h3>输出样例 #1</h3>
<pre><code></code></pre>
</article>
</div>
</div>
</body>
</html>
