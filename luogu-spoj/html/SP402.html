<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>HIKE - Hike on a Graph - 洛谷</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta name="csrf-token" content="1573449591:pMN0aRO6FB5UZvdU2935fOqKAvaMRbobtosZ4ZPb9DQ=">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" media="screen"/>
<link rel="stylesheet" href="https://cdn.luogu.com.cn/fe/loader.css?ver=20191106">
<script>window._feInjection = JSON.parse(decodeURIComponent("%7B%22code%22%3A200%2C%22currentTemplate%22%3A%22ProblemShow%22%2C%22currentData%22%3A%7B%22problem%22%3A%7B%22background%22%3Anull%2C%22description%22%3A%22%5C%22Hike%20on%20a%20Graph%5C%22%20is%20a%20game%20that%20is%20played%20on%20a%20board%20on%20which%20an%20undirected%20graph%20is%20drawn.%20The%20graph%20is%20complete%20and%20has%20all%20loops%2C%20i.e.%20for%20any%20two%20locations%20there%20is%20exactly%20one%20arrow%20between%20them.%20The%20arrows%20are%20coloured.%20There%20are%20three%20players%2C%20and%20each%20of%20them%20has%20a%20piece.%20At%20the%20beginning%20of%20the%20game%2C%20the%20three%20pieces%20are%20in%20fixed%20locations%20on%20the%20graph.%20In%20turn%2C%20the%20players%20may%20do%20a%20move.%20A%20move%20consists%20of%20moving%20one%27s%20own%20piece%20along%20an%20arrow%20to%20a%20new%20location%20on%20the%20board.%20The%20following%20constraint%20is%20imposed%20on%20this%3A%20the%20piece%20may%20only%20be%20moved%20along%20arrows%20of%20the%20same%20colour%20as%20the%20arrow%20between%20the%20two%20opponents%27%20pieces.%5Cn%5Cn%20In%20the%20sixties%20%28%5C%22make%20love%20not%20war%5C%22%29%20a%20one-person%20variant%20of%20the%20game%20emerged.%20In%20this%20variant%20one%20person%20moves%20all%20the%20three%20pieces%2C%20not%20necessarily%20one%20after%20the%20other%2C%20but%20of%20course%20only%20one%20at%20a%20time.%20Goal%20of%20this%20game%20is%20to%20get%20all%20pieces%20onto%20the%20same%20location%2C%20using%20as%20few%20moves%20as%20possible.%20Find%20out%20the%20smallest%20number%20of%20moves%20that%20is%20necessary%20to%20get%20all%20three%20pieces%20onto%20the%20same%20location%2C%20for%20a%20given%20board%20layout%20and%20starting%20positions.%22%2C%22inputFormat%22%3A%22The%20input%20file%20contains%20several%20test%20cases.%20Each%20test%20case%20starts%20with%20the%20number%20_n_.%20Input%20is%20terminated%20by%20_n%3D0_.%20Otherwise%2C%20_1%3C%3Dn%3C%3D50_.%20Then%20follow%20three%20integers%20_p%20%24%20_%7B1%7D%20%24%20%2C%20p%20%24%20_%7B2%7D%20%24%20%2C%20p%20%24%20_%7B3%7D%20%24_%20%20with%20_1%3C%3Dp%20%24%20_%7Bi%7D%20%24%20%3C%3Dn_%20denoting%20the%20starting%20locations%20of%20the%20game%20pieces.%20The%20colours%20of%20the%20arrows%20are%20given%20next%20as%20a%20_n%5Cu00d7n_%20matrix%20_m_%20of%20whitespace-separated%20lower-case%20letters.%20The%20element%20_m%20%24%20_%7Bij%7D%20%24_%20%20denotes%20the%20colour%20of%20the%20arrow%20between%20the%20locations%20_i_%20and%20_j_.%20Since%20the%20graph%20is%20undirected%2C%20you%20can%20assume%20the%20matrix%20to%20be%20symmetrical.%22%2C%22outputFormat%22%3A%22For%20each%20test%20case%20output%20on%20a%20single%20line%20the%20minimum%20number%20of%20moves%20required%20to%20get%20all%20three%20pieces%20onto%20the%20same%20location%2C%20or%20the%20word%20%5C%22impossible%5C%22%20if%20that%20is%20not%20possible%20for%20the%20given%20board%20and%20starting%20locations.%22%2C%22samples%22%3A%5B%5B%223%201%202%203%5Cr%5Cnr%20b%20r%5Cr%5Cnb%20b%20b%5Cr%5Cnr%20b%20r%5Cr%5Cn2%201%202%202%5Cr%5Cny%20g%5Cr%5Cng%20y%5Cr%5Cn0%22%2C%222%5Cr%5Cnimpossible%22%5D%5D%2C%22hint%22%3A%22%22%2C%22provider%22%3A%7B%22uid%22%3A3%2C%22name%22%3A%22%5Cu6d1b%5Cu8c37%22%2C%22slogan%22%3A%22%22%2C%22badge%22%3A%22%22%2C%22isAdmin%22%3Atrue%2C%22color%22%3A%22Purple%22%2C%22ccfLevel%22%3A0%7D%2C%22canEdit%22%3Afalse%2C%22limits%22%3A%7B%22time%22%3A%5B869%5D%2C%22memory%22%3A%5B1536000%5D%7D%2C%22stdCode%22%3A%22%22%2C%22vjudge%22%3A%7B%22origin%22%3A%22SPOJ%22%2C%22link%22%3A%22%5C%2Fjump%5C%2Fspoj%5C%2F402%22%2C%22id%22%3A%22402%22%7D%2C%22tags%22%3A%5B%5D%2C%22wantsTranslation%22%3Atrue%2C%22totalSubmit%22%3A0%2C%22totalAccepted%22%3A0%2C%22pid%22%3A%22SP402%22%2C%22title%22%3A%22HIKE%20-%20Hike%20on%20a%20Graph%22%2C%22difficulty%22%3A0%2C%22type%22%3A%22SP%22%7D%2C%22contest%22%3Anull%2C%22discussions%22%3A%5B%5D%2C%22bookmarked%22%3Afalse%2C%22vjudgeUsername%22%3Anull%2C%22recommendations%22%3A%5B%5D%2C%22lastLanguage%22%3A%22%22%2C%22lastCode%22%3A%22%22%7D%2C%22currentTitle%22%3A%22HIKE%20-%20Hike%20on%20a%20Graph%22%2C%22currentTheme%22%3Anull%7D"));window._feConfigVersion=1572920822;</script>
<script src="https://cdn.luogu.com.cn/fe/loader.js?ver=20191106" charset="utf-8" defer></script>
</head>
<body>
<div id="app">
<div class="lg-container">
<article>
<h1>HIKE - Hike on a Graph</h1>
<h2>题目描述</h2>
<div>"Hike on a Graph" is a game that is played on a board on which an undirected graph is drawn. The graph is complete and has all loops, i.e. for any two locations there is exactly one arrow between them. The arrows are coloured. There are three players, and each of them has a piece. At the beginning of the game, the three pieces are in fixed locations on the graph. In turn, the players may do a move. A move consists of moving one's own piece along an arrow to a new location on the board. The following constraint is imposed on this: the piece may only be moved along arrows of the same colour as the arrow between the two opponents' pieces.
In the sixties ("make love not war") a one-person variant of the game emerged. In this variant one person moves all the three pieces, not necessarily one after the other, but of course only one at a time. Goal of this game is to get all pieces onto the same location, using as few moves as possible. Find out the smallest number of moves that is necessary to get all three pieces onto the same location, for a given board layout and starting positions.</div>
<h2>输入输出格式</h2>
<h3>输入格式</h3>
<br />
<div>The input file contains several test cases. Each test case starts with the number _n_. Input is terminated by _n=0_. Otherwise, _1<=n<=50_. Then follow three integers _p $ _{1} $ , p $ _{2} $ , p $ _{3} $_ with _1<=p $ _{i} $ <=n_ denoting the starting locations of the game pieces. The colours of the arrows are given next as a _n×n_ matrix _m_ of whitespace-separated lower-case letters. The element _m $ _{ij} $_ denotes the colour of the arrow between the locations _i_ and _j_. Since the graph is undirected, you can assume the matrix to be symmetrical.</div>
<h3>输出格式</h3>
<br />
<div>For each test case output on a single line the minimum number of moves required to get all three pieces onto the same location, or the word "impossible" if that is not possible for the given board and starting locations.</div>
<h2>输入输出样例</h2>
<h3>输入样例 #1</h3>
<pre><code>3 1 2 3
r b r
b b b
r b r
2 1 2 2
y g
g y
0</code></pre>
<h3>输出样例 #1</h3>
<pre><code>2
impossible</code></pre>
</article>
</div>
</div>
</body>
</html>
